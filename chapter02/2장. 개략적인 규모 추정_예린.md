# 2. 개략적인 규모 추정
- 보편적으로 통용되는 성능 수치상에서 사고 실험을 행하여 추정치를 계산하는 행위
- 어떤 설계가 요구사항에 부합할 것인지 보기 위함
## 2의 제곱수
데이터 크기와 볼륨은 2의 제곱수로 표현할 줄 알아야한다.

| 2의 x 제곱         | 근사치                | 이름             | 축약형 |
|-------------------|---------------------|------------------|-------|
| 10 (thousand)     | 1천 (thousand)      | 1킬로바이트      | 1 KB  |
| 20 (million)      | 1백만 (million)     | 1메가바이트      | 1 MB  |
| 30 (billion)      | 10억 (billion)      | 1기가바이트      | 1 GB  |
| 40 (trillion)     | 1조 (trillion)      | 1테라바이트      | 1 TB  |
| 50 (quadrillion)  | 1000조 (quadrillion) | 1페타바이트      | 1 PB  |

## 응답 지연 값
Jeff Dean이 2010년 공개한 통상적인 컴퓨터에서 연산들의 응답 지연 값
(일부는 더 이상 유효하지 않지만, 여전히 연산 처리 속도를 짐작하는데 사용)

| 연산명                                              | 시간               |
|----------------------------------------------------|--------------------|
| L1 캐시 참조                                       | 0.5ns              |
| 분기 예측 오류 (branch mispredict)                 | 5ns                |
| L2 캐시 참조                                       | 7ns                |
| 뮤텍스 (mutex) 잠금/해제                            | 25ns               |
| 주 메모리 참조                                     | 100ns              |
| Zippy로 1 KB 압축                                  | 10,000s = 10μs     |
| 1 Gbps 네트워크로 2 KB 전송                         | 20,000ns = 20μs    |
| SSD에서의 1 MB 순차적으로 읽기                      | 250,000ns = 250μs  |
| 회전식 하드 디스크 내에서의 임의의 블록 지연시간   | 500,000ns = 500μs  |
| 디스크 탐색 (seek)                                 | 10,000,000ns = 10ms|
| 네트워크에서 1 MB 순차적으로 보내기                 | 10,000,000ns = 10ms|
| SSD에서도 1 MB 순차적으로 쓰기                      | 1,000,000ns = 1ms  |
| 한 패킷의 CA(캘리포니아)로부터 네덜란드까지의 왕복 지연시간 | 150,000,000ns = 150ms|

- 메모리는 빠르지만 디스크는 느리다
- 디스크 탐색은 가능한 한 피하라
- 단순한 압축 알고리즘은 빠르다.
- 데이터를 인터넷으로 전송하기 전에 가능하면 압축하라.
- 데이터 센터는 보통 여러 지역에 분산되어 있고, 센터 간 데이터를 주고받는 데는 시간이 걸린다.

## 가용성 관련 수치들
- 가용성: 시스템이 오랜 시간 동안 지속적으로 중단 없이 운영될 수 있는 능력
- 표현: %로 표현, 100% = 시스템이 단 한번도 중단된 적 없음
- SLA(Service Level Agreement): 사업자와 고객 사이에 맺어진 합의
  - 사업자가 제공하는 서비스의 가용 시간이 공식적으로 기술
  - **99% 이상**의 SLA가 일반적
  
    | 가용률       | 하루당 장애시간 | 주당 장애시간  | 개월당 장애시간 | 연간 장애시간  |
    |--------------|----------------|----------------|----------------|----------------|
    | 99%          | 14.40분        | 1.68 시간      | 7.31 시간      | 3.65 일        |
    | 99.9%        | 1.44 분        | 0.10 시간      | 43.83 시간     | 8.77 일        |
    | 99.99%       | 8.64 초        | 0.00438 시간   | 52.60 시간     | 8.77 일        |
    | 99.999%      | 864 밀리초     | 26.30 초       | 5.26 시간      | 11.60 일       |
    | 99.9999%     | 86.40 밀리초   | 604.80 밀리초  | 2.63 시간      | 31.56 일       |

## 예제: 트위터 QPS와 저장소 요구량 추정
### 가정
- MAU: 3억 명
- 50%의 사용자가 매일 사용.
- 사용자당 하루 평균 2건의 트윗 게시.
- 미디어를 포함한 트윗: 10%
- 데이터 보관: 5년
### 추정
- DAU = MAU x 50% = 1.5억 명
- QPS = DAU x 2 트윗 / 24시간 / 3600초 = 약 3500
- 최대 QPS = 2 x QPS = 약 7000
### 저장소 요구량
- 평균 트윗 크기:
  - tweet_id: 64 Bytes
  - 텍스트: 140 Bytes
  - 미디어: 1 MB
- 미디어 저장량: 1.5억 x 2 x 10% x 1MB = 30TB
- 5년간 미디어 저장량: 30TB x 365 x 5 = 약 55PB

## 마무리
개략적 규모 추정 시 주요한 것은 문제를 풀어 나가는 절차다. 올바른 절차를 밟느냐가 결과를 내는 것보다 중요하다.
- 근사치를 활용한 계산
- 가정들은 적어 두라.
- 단위를 붙여라.
- 연습해라.
