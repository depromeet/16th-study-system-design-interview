# **알림 시스템 설계**

## **1. 문제 이해 및 설계 범위 확정**
### **알림 시스템 개요**
- 푸시 알림, SMS, 이메일을 통해 사용자에게 중요한 정보를 비동기적으로 전달하는 시스템
- 서비스 운영에서 필수적인 기능으로 자리 잡음

### **요구 사항**
- **알림 유형**: 푸시 알림 (iOS, Android), SMS, 이메일 지원
- **전송 속도**: 실시간은 아니지만 빠른 전달이 필요
- **지원 단말**: iOS, Android, 데스크톱
- **발송 주체**: 클라이언트 앱과 서버 모두 가능
- **사용자 설정**: 알림 수신 거부(Opt-Out) 기능 제공
- **처리량**:
    - 하루 **1,000만 건**의 푸시 알림
    - 하루 **100만 건**의 SMS
    - 하루 **500만 건**의 이메일

---

## **2. 개략적 설계**
### **알림 유형별 처리 방식**
- **iOS 푸시 알림**: APNS (Apple Push Notification Service)를 통해 전달
- **Android 푸시 알림**: FCM (Firebase Cloud Messaging) 사용
- **SMS**: Twilio, Nexmo 등 제3자 서비스 활용
- **이메일**: SendGrid, Mailchimp 등 외부 이메일 서비스 사용

### **연락처 정보 수집 절차**
- 사용자 앱 설치 또는 계정 등록 시 API 서버가 단말 정보(토큰), 이메일, 전화번호를 저장

### **알림 전송 및 수신 절차**
1. 서비스(쇼핑몰, 청구서 시스템 등)에서 알림 전송 요청
2. 알림 서버가 요청을 받아 데이터베이스에서 사용자 정보를 조회
3. 적절한 메시지 큐에 알림을 등록
4. 작업 서버가 큐에서 알림을 가져와 제3자 서비스(APNS, FCM 등)에 전달
5. 제3자 서비스가 사용자 단말로 알림을 전송

<img width="990" alt="image" src="https://github.com/user-attachments/assets/3f9047c5-98c2-40c4-b4fd-6405556ab431" />

---

## **3. 상세 설계**
### **안정성 (Reliability)**
- **데이터 손실 방지**: 알림 데이터 저장 및 재시도(재발송) 메커니즘 적용
- **중복 전송 방지**: 이벤트 ID를 이용해 중복 탐지 후 필터링
- **큐 모니터링**: 큐에 쌓인 알림 개수를 확인하고, 병목 발생 시 서버 추가 확장

### **추가 고려 사항**
- **알림 템플릿**: 알림 내용을 미리 정의하여 일관성 유지 및 전송 시간 단축
- **사용자 설정**: 알림 수신 여부 및 채널 선택 가능하도록 설정
- **전송률 제한 (Rate Limiting)**: 사용자가 과도한 알림을 받지 않도록 빈도 조절
- **보안**: 인증된 클라이언트만 알림 API 사용 가능하도록 `appKey`, `appSecret` 적용
- **이벤트 추적 및 분석**:
    - 알림 발송 성공/실패율, 클릭률 추적
    - 시스템 상태 모니터링을 위한 대시보드 제공

### **개선된 설계안**
- **메시지 큐 도입**: 시스템 간 결합도 제거, 비동기 처리
- **알림 서버 확장 가능**: 여러 개의 작업 서버를 추가해 부하 분산
- **알림 전송 로그 유지**: 재시도 및 분석을 위한 로그 저장

  <img width="868" alt="image" src="https://github.com/user-attachments/assets/a4de6140-05b9-4fa8-9e3d-a32e724eef80" />
---

## **4. 결론**
- 알림 시스템은 다양한 채널을 통해 사용자와 소통하는 필수 기능
- 메시지 큐 기반 설계를 통해 **확장성, 안정성, 비동기성**을 확보
- 사용자의 피로감을 줄이기 위한 **전송률 제한, 알림 설정 기능** 추가
- 이벤트 추적을 통해 **알림 효과 분석 및 시스템 개선 가능**

알림 시스템을 성공적으로 설계하고 확장 가능하게 구성하면 사용자 경험을 개선할 수 있으며, 서비스의 운영 효율성도 증가시킬 수 있다.
