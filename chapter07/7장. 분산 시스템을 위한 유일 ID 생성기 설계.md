# **분산 시스템을 위한 유일 ID 생성기 설계**

## **1. 개요**
- **유일 ID 생성기**는 **분산 환경에서 유일성과 정렬 가능성을 보장하는 ID**를 생성해야 함.
- 기존 **Auto Increment 기반의 관계형 DB 접근법은 분산 환경에서 확장성이 부족**.
- **요구 사항**:
    - **유일성 보장**
    - **숫자(Numeric) 형태**
    - **64비트 이내**
    - **시간 순서대로 정렬 가능**
    - **초당 10,000개 이상의 ID 생성 가능**

---

## **2. 유일 ID 생성 전략 비교**
### **1) 다중 마스터 복제(Multi-Master Replication)**
- **방식**: 여러 DB 서버가 각각 Auto Increment ID를 생성하되, 일정 간격(k)를 증가시킴.
- **장점**:
    - 분산 환경에서도 일정 부분 확장 가능.
- **단점**:
    - 여러 데이터센터를 활용하기 어려움.
    - 시간 순 정렬이 보장되지 않음.
    - 서버 추가/삭제 시 관리가 복잡함.

### **2) UUID (Universally Unique Identifier)**
- **방식**: 각 노드에서 독립적으로 128비트 크기의 UUID 생성.
- **장점**:
    - 별도의 조율 없이 ID를 생성 가능.
    - 확장성이 뛰어남.
- **단점**:
    - **128비트로 크기가 너무 큼** (요구사항 위반).
    - **시간 정렬이 불가능함**.
    - **숫자가 아닌 값이 포함될 수 있음**.

### **3) 티켓 서버(Ticket Server)**
- **방식**: 중앙 서버(티켓 서버)가 ID를 발급하고 모든 요청이 이를 통해 처리됨.
- **장점**:
    - **유일성이 보장됨**.
    - **숫자로만 구성된 ID 생성 가능**.
- **단점**:
    - **SPOF (Single Point of Failure, 단일 장애점) 문제가 발생**.
    - **서버 장애 시 모든 시스템이 영향을 받음**.
    - **고가용성을 보장하려면 다중 서버 운영 필요**.

### **4) 트위터 스노우플레이크(Twitter Snowflake)**
- **방식**: ID를 여러 섹션(Section)으로 나누어 64비트 내에서 생성.
- **구조**:
    - **1비트**: 예약(사용 안 함)
    - **41비트**: 타임스탬프 (밀리초 단위, Epoch 기준)
    - **5비트**: 데이터센터 ID (최대 32개 센터)
    - **5비트**: 서버 ID (데이터센터당 최대 32개 서버)
    - **12비트**: 일련번호 (밀리초당 최대 4096개 ID 생성)
- **장점**:
    - **유일성과 정렬 가능성 보장**.
    - **고성능 및 높은 확장성 제공**.
- **단점**:
    - 시스템 간 **시간 동기화 필요** (NTP 사용).
    - **일련번호 초과 시 지연 발생 가능**.

---

## **3. 상세 설계**
### **1) 타임스탬프(Timestamp)**
- **41비트**를 사용하여 기준 Epoch(예: `Nov 04, 2010 01:42:54 UTC`) 이후의 **경과 밀리초(ms) 값을 저장**.
- **최대 값**: `2^41 - 1 = 2199023255551ms` (약 **69년 동안 사용 가능**).
- 이후 **Epoch를 변경하거나 ID 체계를 마이그레이션**해야 함.

### **2) 일련번호(Sequence Number)**
- **12비트** 사용 → **한 서버에서 밀리초당 4096개까지 ID 생성 가능**.
- **같은 밀리초 내에서는 1씩 증가**.
- **밀리초가 변경되면 0으로 초기화**.

---

## **4. 고급 고려 사항**
### **1) 시간 동기화 (Clock Synchronization)**
- 모든 ID 생성기가 **동일한 시간 기준을 사용해야 함**.
- **NTP(Network Time Protocol) 활용**.

### **2) 유연한 필드 크기 조정**
- 동시성이 낮은 애플리케이션이라면 **일련번호 길이를 줄이고 타임스탬프를 늘리는 것이 가능**.

### **3) 고가용성 (High Availability)**
- ID 생성기는 **필수적인 서비스(Mission Critical Component)**이므로 **서버 장애 대비가 필요**.

---

## **5. 결론**
## **5. 결론**
각 유일 ID 생성 전략의 장단점을 비교한 리스트:

### **1) 다중 마스터 복제**
- **장점**: 확장 가능
- **단점**:
    - 시간 정렬 불가능
    - 서버 추가 시 복잡

### **2) UUID**
- **장점**: 서버 조율 필요 없음
- **단점**:
    - 128비트로 길어 저장 및 전송 비효율적
    - 숫자가 아닌 값이 포함될 수 있음
    - 시간 정렬이 불가능함

### **3) 티켓 서버**
- **장점**:
    - 유일성 보장
    - 숫자로만 구성된 ID 생성 가능
- **단점**:
    - SPOF(Single Point of Failure) 문제 발생
    - 장애 발생 시 전체 시스템이 영향을 받음

### **4) 스노우플레이크**
- **장점**:
    - 유일성 보장
    - 시간 순 정렬 가능
    - 높은 확장성
- **단점**:
    - 시간 동기화 필요 (NTP 활용 필요)
    - 일련번호 초과 시 대기 시간 발생 가능

> **최종 선택**: **트위터 스노우플레이크 방식**
> - **64비트 내에서 유일성과 정렬 가능성을 보장**.
> - **고성능 및 확장성 제공**.
> - **시간 동기화 필요하지만, 분산 환경에서 가장 적합한 방식**.

## 6. 궁금증