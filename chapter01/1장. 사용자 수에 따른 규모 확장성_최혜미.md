# **사용자 수에 따른 규모 확장성**

## **1. 단일 서버 시스템**
### 📌 개념
- 초기에는 **단일 서버**에서 모든 요청을 처리하는 것이 일반적이다.
- 웹 애플리케이션, 데이터베이스, 캐시가 모두 하나의 서버에서 실행된다.

### 📌 문제점
- 사용자가 증가할수록 **서버 부하 증가** → 응답 속도 저하.
- **단일 장애 지점(SPOF, Single Point of Failure)** 발생 → 서버가 죽으면 서비스 중단.
- 리소스(CPU, RAM, 디스크)의 한계로 인해 **트래픽 증가에 유연하게 대응할 수 없음**.(scale up의 한계)

---

## **2. 서버 확장 방법**
단일 서버의 한계를 극복하기 위해 **서버 확장(Scaling)** 이 필요하다.

### **📌 수직적 확장 (Scale-Up)**
- 기존 서버의 **CPU, RAM, 디스크 용량을 증설**하여 성능을 향상시키는 방법.
- **장점**: 설정이 간단하며 코드 변경 없이 확장 가능.
- **단점**:
    - 하드웨어 한계 존재 (무한 확장 불가능).
    - 단일 장애 지점 문제 해결 불가.
    - 고성능 서버는 매우 비싸므로 비용 문제 발생.

### **📌 수평적 확장 (Scale-Out)**
- 여러 대의 서버를 추가하여 트래픽을 분산시키는 방법.
- **로드 밸런서(Load Balancer)** 를 사용하여 여러 대의 서버에 부하를 분산함.

#### **📌 로드 밸런서 (Load Balancer)**
- 클라이언트 요청을 여러 서버로 분배하여 **성능 향상 및 가용성 확보**.
- 특정 서버가 다운되면 자동으로 다른 서버로 요청을 전송하여 서비스 지속 가능.
- **대표적인 로드 밸런싱 알고리즘**:
    - **Round Robin**: 순차적으로 서버에 요청을 전달.
    - **Least Connections**: 현재 가장 적은 연결을 가진 서버로 요청을 보냄.
    - **IP Hashing**: 클라이언트의 IP를 해싱하여 특정 서버에 요청을 전달.

---

## **3. 데이터 계층 확장**
단순히 웹 서버를 확장하는 것만으로는 충분하지 않다.  
데이터베이스도 함께 확장해야 한다.

### **📌 데이터베이스 다중화 (Master-Slave)**
- **Master**: 쓰기 연산(INSERT, UPDATE, DELETE) 전담.
- **Slave**: 읽기 연산(SELECT) 전담.
- **장점**:
    - 읽기 부하를 여러 Slave 서버로 분산하여 성능 향상.
    - Master 서버 장애 시, Slave를 Master로 승격하여 **장애 대응 가능**.
- **단점**:
    - **복제 지연(Lag) 문제** 발생 가능 (Master에서 변경된 데이터가 Slave에 반영되는 데 시간 차이 존재).

### **📌 샤딩 (Sharding)**
- **데이터를 여러 개의 샤드(Shard)로 분산 저장**하는 방식.
- **예시**: `user_id % 4` 연산을 통해 특정 샤드에 저장.
- **장점**:
    - 데이터베이스 성능을 무한히 확장할 수 있음.(scale out)
    - 특정 샤드에 대한 부하를 줄여 성능 개선 가능.
- **단점**:
    - 샤딩 키를 잘못 설계하면 데이터 불균형 문제 발생.(데이터 재샤딩 필요 : 해시함수 변경 + 데이터 재배치)
    - 조인(Join) 연산이 어려워질 수 있음
    - 특정 샤드에 쿼리가 집중될 가능성 있음(유명인사문제)

---

## **4. 성능 최적화 기법**
데이터베이스 부하를 줄이고 **응답 속도를 개선**하는 기법이 필요하다.

### **📌 캐시 (Cache)**
- **자주 조회되는 데이터**를 메모리에 저장하여 **빠르게 반환**.
- **왜 필요한가?**
    - 매번 데이터베이스를 조회하면 성능 저하 발생.
    - 읽기 요청이 많은 경우, **데이터베이스의 부하를 획기적으로 줄일 수 있음**.
- **전략**:
    - **읽기 주도형 캐싱 (Read-Through)**:
        - 캐시에 데이터가 있으면 반환.
        - 없으면 DB에서 가져와 캐시에 저장 후 반환.
    - **캐시 만료 정책**:
        - **TTL(Time To Live)** 설정하여 일정 시간 이후 자동 삭제.
        - **LRU(Least Recently Used), LFU(Least Frequently Used)** 등 알고리즘 활용.
    - **일관성 문제 해결**:
        - 데이터베이스가 변경될 때 캐시도 함께 갱신(Evict).

### **📌 CDN (Content Delivery Network)**
- **정적 콘텐츠 (CSS, JS, 이미지 등)** 를 전 세계 여러 지역의 서버에 캐싱하여 제공.
- **장점**:
    - 사용자가 가까운 CDN 서버에서 데이터를 가져오므로 응답 속도 향상.
    - 원본 서버의 부하 감소.
- **고려할 사항**:
    - **콘텐츠 갱신**: 자주 변경되는 콘텐츠는 TTL을 짧게 설정하거나 버저닝 적용.

---

## **5. 무상태 웹 계층 (Stateless Web Layer)**
### **📌 문제점**
- 사용자의 **세션 정보를 웹 서버가 직접 저장**하면, 특정 서버에서만 요청을 처리 가능.
- 서버 개수를 늘려도 특정 서버로 요청이 몰리는 문제 발생.

### **📌 해결책**
- **세션 데이터를 Redis, DB 같은 공유 저장소에 저장**하여 어떤 웹 서버에서도 요청을 처리 가능하도록 설계.
- **장점**:
    - 확장성이 뛰어나며, 서버를 추가/제거해도 무리 없이 동작 가능.
    - 로드 밸런서를 통해 요청을 균등하게 분산할 수 있음.

---

## **6. 다중 데이터 센터 (Multi-Data Center)**
### **📌 왜 필요한가?**
- 하나의 데이터 센터에서 장애가 발생하면 서비스 전체가 중단될 수 있음.
- 전 세계 사용자에게 **더 나은 성능**을 제공하기 위해 지리적으로 분산된 데이터 센터 필요.

### **📌 해결책**
- **GeoDNS 라우팅**을 활용하여 사용자를 가장 가까운 데이터 센터로 연결.
- **장애 발생 시 트래픽 우회**: 한 데이터 센터가 다운되면, 다른 데이터 센터로 트래픽 전송.

---

## **7. 메시지 큐 (Message Queue)**
### **📌 개념**
- 서버 간 비동기 작업을 수행하기 위한 **메시지 큐 시스템**.
- **예시**: 사진 업로드 시, 즉시 저장하지 않고 큐에 넣고 백그라운드에서 처리.
- 조절은 큐가 커지면 소비자를 늘리고, 큐가 비어있는 시간이 많으면 소비자를 줄이는 방식으로 조정

### **📌 장점**
- **생산자(Producer)** 와 **소비자(Consumer)** 를 분리하여 서버 간 결합도를 낮춤.
- **비동기 작업 지원** → 서버 부하를 줄이고 처리 속도 향상.
- **장애 대응**:
    - 소비자 서버가 일시적으로 다운되더라도 메시지는 큐에 남아 있음.
    - 소비자가 복구되면 다시 처리 가능.


---

## **8. 운영 및 모니터링**
### **📌 필요성**
- 서버가 많아질수록 **장애 감지 및 성능 최적화**가 중요해짐.
- **실시간 모니터링**으로 서버 상태를 체크하고, 이상 발생 시 빠르게 대응.

### **📌 주요 요소**
- **로그(Log) 수집**: 서버 및 애플리케이션 오류 추적.
- **메트릭(Metrics) 모니터링**:
    - CPU, 메모리, 디스크 사용량 분석.
    - 트래픽 변화 감지 및 자동 확장(Auto Scaling).
- **CI/CD 자동화**: 배포 및 테스트 자동화하여 운영 효율성 극대화.

---

## **📌 핵심 요약**
1. **무상태 웹 계층**을 도입하여 수평적 확장 가능하게 설계.
2. **로드 밸런서**를 활용하여 서버 부하를 분산.
3. **데이터베이스 다중화(Master-Slave, 샤딩)** 로 확장성 확보.
4. **캐시 & CDN**을 활용하여 성능 최적화.
5. **다중 데이터 센터 운영**으로 장애 대응.
6. **메시지 큐를 활용한 비동기 작업 처리**로 시스템 안정성 향상.
7. **자동화된 모니터링 및 배포 시스템 구축**으로 운영 효율성 극대화.
