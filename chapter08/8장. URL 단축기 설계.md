# **URL 단축기 설계**

## **1. 문제 이해 및 설계 범위 확정**
### **요구 사항**
- 긴 URL을 짧게 변환하는 기능
- 단축된 URL을 원래 URL로 리디렉션
- 높은 가용성과 확장성 보장
- 데이터 삭제 및 갱신 불가

### **트래픽 규모 예상**
- **초당 단축 URL 생성**: 1160개 (1억 개 / 24시간 / 3600초)
- **초당 읽기 요청**: 11,600개 (쓰기 대비 10:1 비율 가정)
- **저장 용량**: 10년 기준, 36.5TB (1억 개 x 365일 x 10년 x 100바이트)

---

## **2. 개략적 설계**
### **API 엔드포인트**
1. **URL 단축**
    - `POST /api/v1/data/shorten`
    - 요청: `{ longUrl: "http://example.com" }`
    - 응답: `{ shortUrl: "https://tinyurl.com/abcd123" }`
2. **URL 리디렉션**
    - `GET /api/v1/shortUrl`
    - 응답: 301 또는 302 Redirect

### **리디렉션 방식**
- **301 (Permanent Redirect)**: 브라우저 캐시 활용 가능, 서버 부하 감소
- **302 (Found, Temporary Redirect)**: 실시간 트래픽 분석 가능

---

## **3. 상세 설계**
### **데이터 모델**
| **컬럼** | **설명** |
|---------|---------|
| `id` | 기본 키 (Unique ID) |
| `shortURL` | 단축 URL |
| `longURL` | 원래 URL |

### **해시 함수**
- **Base-62 변환** (62개 문자 사용, `0-9`, `a-z`, `A-Z`)
- 7자리 길이로 변환하여 3.5조 개 URL 저장 가능

### **단축 URL 생성 과정**
1. 입력된 `longURL`이 DB에 존재하는지 확인
2. 존재하면 기존 `shortURL` 반환
3. 존재하지 않으면 `Unique ID` 생성 후 `Base-62` 변환
4. 변환된 `shortURL`을 DB에 저장 후 반환

### **리디렉션 처리**
- 단축 URL이 캐시에 존재하면 바로 응답
- 없으면 DB 조회 후 캐시에 저장
- 잘못된 URL이면 404 응답

---

## **4. 추가 고려 사항**
- **Rate Limiting**: 대량 요청 방지 (IP 제한)
- **웹 서버 확장**: Stateless 구조로 확장 가능
- **데이터베이스 확장**: 샤딩(Sharding) 및 복제 적용
- **트래픽 분석**: 클릭 수 및 시간대 추적 가능
- **가용성 및 일관성**: CAP 이론 적용, 장애 복구 대비

---

## **5. 결론**
| **방법** | **장점** | **단점** |
|---------|---------|---------|
| **해시 후 충돌 해결** | 고정된 길이 유지 가능 | 충돌 가능성 존재, 추가 연산 필요 |
| **Base-62 변환** | 유일성 보장, 성능 우수 | ID 유출 가능성 (보안 문제) |

> ### **최종 선택**: **Base-62 변환**
> - URL 길이 최적화 가능
> - 성능과 확장성이 뛰어나 대규모 시스템에 적합
