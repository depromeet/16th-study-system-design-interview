## 11장 뉴스 피드 시스템 설계

### 문제 이해 및 설계 범위 확정
- 모바일 앱 / 웹 어떤 것을 지원해야 하는지
- 중요한 기능은 무엇인지
- 어떤 순서로 컨텐츠가 표시되는지
- 최대 몇명의 친구를 가질 수 있는지
- 트래픽 규모는 어느정도 인지
- 이미지나 비디오도 올라올 수 있는지

### 피드 발행 
- 새 스토리를 포스팅하는 api
- 새 포스팅을 데이터베이스와 캐시에 저장한다
- 친구의 뉴스 피드에 push 하는데 캐시에 보관하여 빠르게 읽을 수 있게 한다
- 푸시 알림을 보내자

### 뉴스 피드 생성
- 사용자가 보는 뉴스 피드가 어떻게 만들어 지는가
- 뉴스 피드 서비스: 캐시에서 뉴스 피드를 가지고 온다
- 뉴스 피드 캐시: 뉴스 피드를 렌더링할 때 필요한 피드 ID를 보관

### 피드 발행 흐름 상세 설계
- 스팸을 막고 유해한 콘텐츠를 방지하기 위해, 특정 기간 동안 한 사용자가 올리는 포스팅 개수에 제한을 두자
- 포스팅 전송(팬아웃) 서비스: 새 포스팅을 친구 관계에 있는 사용자에게 전달
  - 쓰기 시점 팬아웃: 포스팅이 완료되면 바로 사용자 캐시에 기록
    - 실시간 갱신, 뉴스 피드 읽기 시간 감소
    - 친구가 많으면 뉴스 피드 갱신하는데 시간이 많은 시간이 걸린다. 핫키 문제
    - 컴퓨팅 자원의 낭비
  - 읽기 시점 팬아웃: 피드를 읽는 시점에 갱신
    - 비활성화 사용자가 많을 때 유리
    - 뉴스 피드 읽는데 시간이 많이 걸릴 수 있음

### 피드 읽기 흐름 상세 설계
- 이미지나 비디오는 CDN에 저장하여 빠르게 읽게 하자
- 뉴스 피드 캐시에서 포스팅 ID 목록을 가져오고, 사용자 캐시 포스팅 캐시에서 피드에 표기할 데이터를 가져와 완전한 뉴스 피드 생성

### 캐시 구조
- 뉴스 피드: 뉴스 피드 ID 보관
- 콘텐츠: 포스팅 데이터
- 소셜 그래프: 사용자 간 관계 정보
- 행동: 좋아요, 답글 등 사용자 행위 정보 보관
- 횟수: 좋아요, 응답, 팔로워 숫자 정보 보관

### 추가 논의 해보면 좋은 것
- 웹 계층을 무상태로 운영하기
- 가능한 한 많은 데이터를 캐시할 방법
- 여러 데이터 센터를 지원할 방법
- 메시지 큐를 사용해 컴포넌트 사이의 결합도 낮추기
- 핵심 메트릭 모니터링
