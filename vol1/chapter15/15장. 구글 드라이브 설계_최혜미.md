# 구글 드라이브 설계 요약

구글 드라이브는 문서, 사진, 비디오 등 다양한 파일을 클라우드에 저장하고, 여러 단말에서 동기화 및 공유할 수 있는 서비스입니다. 이 설계 요약은 파일 업로드/다운로드, 동기화, 버전 관리, 파일 공유 및 알림 등 핵심 기능과 확장성, 안정성 요구사항에 대해 정리한 내용입니다.

---

## 1. 요구사항

### 기능적 요구사항
- **파일 업로드/다운로드**
    - 단순 업로드 (소규모 파일)
    - 이어 올리기 (resumable upload): 대용량 파일, 네트워크 장애 시 재시작 지원
- **파일 동기화**
    - 여러 단말(앱, 웹, 모바일 등) 간 실시간 파일 동기화
- **파일 갱신 이력 조회 (Revision History)**
    - 누가, 언제, 무엇을 변경했는지 확인
- **파일 공유**
    - 파일 편집, 삭제, 새 공유 등의 이벤트 발생 시 알림 제공
- **파일 암호화**
    - 파일 저장 시 보안을 위한 암호화 적용

### 비기능적 요구사항
- **안정성**: 데이터 손실 없이 파일을 보관해야 함
- **빠른 동기화 속도**: 사용자 이탈 방지 (특히 모바일 네트워크 환경 고려)
- **규모 확장성**: 대량의 트래픽과 데이터를 처리할 수 있어야 함
- **높은 가용성**: 일부 서버나 네트워크 장애 상황에서도 시스템 지속 운영

### 추정치
- 가입 사용자: 5천만 명
- 일간 능동 사용자(DAU): 1천만 명
- 사용자 당 무료 저장 공간: 10GB  
  → 총 필요 저장공간: 약 500PB
- 파일 업로드: 사용자당 하루 평균 2개 (평균 파일 크기 500KB)
- 업로드 API QPS: 약 240 (최대 480)

---

## 2. 개략적 시스템 아키텍처

### 주요 컴포넌트
- **클라이언트**: 앱, 웹, 모바일 등 다양한 단말
- **로드밸런서**: API 서버로의 트래픽 분산 및 장애 우회
- **API 서버**:
    - 파일 업로드, 다운로드, 동기화, 메타데이터 갱신, 사용자 인증 등 처리
    - 파일 갱신 이력 및 공유 알림 등 부가 기능 제공
- **메타데이터 데이터베이스**
    - 사용자, 파일, 버전, 공유 정보 등의 메타데이터 저장
    - 파일 실제 데이터는 저장소에 별도로 보관 (DB에는 블록 해시 값 저장)
- **메타데이터 캐시**
    - 자주 조회되는 메타데이터를 캐싱하여 빠른 응답 보장
- **파일 저장소 (클라우드 저장소)**
    - S3와 같은 객체 저장소를 사용하여 다중 리전/다중화로 높은 확장성과 가용성 확보
- **블록 저장소 서버**
    - 파일을 여러 블록(예: 4MB)으로 분할하여 저장
    - 각 블록은 고유의 해시값을 부여하여 메타데이터 DB에 저장
    - **델타 동기화**: 변경된 블록만 업데이트
    - **압축**: gzip, bzip2 등 압축 적용으로 저장 공간 절약
- **알림 서비스**
    - 파일 변경(편집, 삭제, 공유 등) 이벤트 발생 시 클라이언트에 알림 전송
    - **구현 방식**: 롱 폴링 (Dropbox 방식) 또는 웹소켓 (양방향 통신)

### 추가 구성 요소
- **오프라인 사용자 백업 큐**
    - 사용자가 접속 중이지 않을 때 변경 정보를 저장, 접속 시 동기화 지원
- **아카이빙 저장소 (Cold Storage)**
    - 장기간 사용되지 않는 데이터는 S3 Glacier와 같은 아카이빙 스토리지로 이동

---

## 3. 파일 업로드 및 다운로드 API

### 파일 업로드 API
- **단순 업로드**: 작은 파일에 적합
- **이어 올리기 (Resumable Upload)**
    - 최초 요청 → 이어 올리기 URL 획득
    - 파일 데이터 업로드 및 상태 모니터링
    - 업로드 장애 발생 시, 장애 시점부터 재시작

_예시 URL_:  https://api.example.com/files/upload?uploadType=resumable


### 파일 다운로드 API
- 파일 경로를 인자로 받아 다운로드 처리

_예시 URL_:  https://api.example.com/files/download?path=/example/file.txt


### 파일 갱신 이력 API
- 파일의 수정 내역(누가, 언제, 무엇을 변경했는지) 조회

_예시 URL_:  https://api.example.com/files/list_revisions?path=/example/file.txt&limit=10


---

## 4. 확장성 및 데이터 일관성 전략

### 한 대 서버의 제약 극복
- **샤딩**: 데이터를 여러 서버에 분산 저장
- **클라우드 저장소 활용 (S3)**
    - 높은 확장성, 다중 리전 다중화로 데이터 손실 방지
- **메타데이터 DB 분리 및 다중화**
    - SPOF 회피 및 확장성 확보

### 강한 일관성 요구
- **일관성 모델**: 강한 일관성(strong consistency) 보장
- 캐시와 DB 간의 동기화
    - 원본 변경 시 캐시 무효화 및 재갱신

### 동기화 충돌 해결
- **버전 관리**를 통한 동기화 충돌 해결
    - 두 명 이상의 사용자가 동시에 업데이트할 경우,
        - 먼저 적용된 변경을 우선 처리
        - 나중에 적용되는 변경은 충돌로 표시 후 합치거나 대체 결정

---

## 5. 저장 공간 최적화

- **중복 재거 (Deduplication)**
    - 파일 블록 해시값 비교를 통한 중복 데이터 제거
- **지능적 백업 전략**
    - 파일 버전 수 제한: 중요 버전만 보관
    - 자주 수정되지 않는 파일은 불필요한 버전 생성 방지
- **아카이빙**
    - 자주 사용되지 않는 데이터는 저비용 아카이빙 스토리지로 이전

---

## 6. 알림 서비스

- **역할**: 파일 변경(편집, 삭제, 공유 등) 이벤트 발생 시 클라이언트에 알림 전송
- **구현 옵션**
    - **롱 폴링 (Long Polling)**: 클라이언트가 지속적으로 연결을 유지하며 변경 감지 시 연결 종료 → 메타데이터 갱신 요청
    - **웹소켓 (WebSocket)**: 양방향 통신으로 실시간 알림 제공 (필요에 따라 선택)

---

## 7. 요약

- **구글 드라이브 설계**는 파일 업로드/다운로드, 동기화, 버전 관리, 파일 공유 및 알림 기능을 중심으로 하며,
- **클라우드 저장소(S3)**, **블록 저장소 서버**, **메타데이터 DB/캐시** 등을 통해 높은 확장성과 강한 일관성을 보장합니다.
- 동기화 충돌, 중복 재거, 지능적 백업 전략 및 알림 서비스 등 다양한 최적화 및 오류 처리 방식을 도입하여 안정적이고 빠른 파일 저장/동기화 서비스를 제공합니다.



